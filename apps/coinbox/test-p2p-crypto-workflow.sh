#!/bin/bash

# P2P Crypto Marketplace - Manual Testing Script
# This script helps you test the complete trade workflow

set -e

echo "ğŸ§ª P2P Crypto Marketplace - Manual Testing Guide"
echo "================================================="
echo ""
echo "âœ… Server running at: http://localhost:9004"
echo ""
echo "ğŸ“‹ MANUAL TESTING CHECKLIST"
echo ""
echo "Prerequisites:"
echo "  [ ] Two user accounts ready (User A = Seller, User B = Buyer)"
echo "  [ ] Both users have valid sessions"
echo "  [ ] User A has crypto balance (for selling)"
echo "  [ ] User B has ZAR balance (for buying)"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 1: CREATE LISTING (User A - Seller)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Open browser: http://localhost:9004/p2p-crypto/create"
echo "2. Login as User A (seller)"
echo "3. Fill in the form:"
echo "   - Type: SELL"
echo "   - Asset: BTC"
echo "   - Crypto Amount: 0.01"
echo "   - Price per Unit: 1,200,000 ZAR"
echo "   - Payment Method: Bank Transfer"
echo "   - Terms: 'Payment within 1 hour'"
echo "4. Click 'Create Listing'"
echo ""
echo "Expected Results:"
echo "  âœ“ Success message displayed"
echo "  âœ“ Redirected to marketplace"
echo "  âœ“ Listing appears in active listings"
echo "  âœ“ Total amount: R12,000 (0.01 Ã— 1,200,000)"
echo ""
read -p "Press Enter when Step 1 is complete..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 2: BROWSE MARKETPLACE (User B - Buyer)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Open new incognito/private window"
echo "2. Navigate to: http://localhost:9004/p2p-crypto/marketplace"
echo "3. Login as User B (buyer)"
echo "4. Filter by:"
echo "   - Asset: BTC"
echo "   - Type: SELL"
echo "5. Find User A's listing"
echo "6. Click on the listing to view details"
echo ""
echo "Expected Results:"
echo "  âœ“ Marketplace page loads"
echo "  âœ“ User A's listing visible"
echo "  âœ“ AI price prediction displayed (if available)"
echo "  âœ“ Listing shows correct details"
echo ""
read -p "Press Enter when Step 2 is complete..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 3: ACCEPT TRADE (User B - Buyer)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. On listing detail page, click 'Accept Trade'"
echo "2. Review trade details in confirmation dialog"
echo "3. Click 'Confirm' to accept"
echo ""
echo "Expected Results:"
echo "  âœ“ Success message: 'Trade matched successfully!'"
echo "  âœ“ Transaction created with ID"
echo "  âœ“ Redirected to dashboard or trade page"
echo "  âœ“ Status: 'Pending Payment'"
echo "  âœ“ Payment instructions displayed"
echo ""
echo "âš ï¸  IMPORTANT: Copy the Transaction ID for next steps"
echo ""
read -p "Press Enter when Step 3 is complete..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 4: MAKE PAYMENT (User B - Real World Action)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“± Real World Action (Simulated for Testing):"
echo ""
echo "In production, User B would:"
echo "  1. Get User A's bank details from the platform"
echo "  2. Make bank transfer of R12,000"
echo "  3. Keep payment reference"
echo ""
echo "For testing, we'll simulate this step."
echo ""
read -p "Press Enter to proceed to payment confirmation..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 5: CONFIRM PAYMENT (User B - Buyer)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Navigate to: http://localhost:9004/p2p-crypto/dashboard"
echo "2. Find the active transaction"
echo "3. Click 'I Have Paid' button"
echo "4. Confirm payment confirmation"
echo ""
echo "Expected Results:"
echo "  âœ“ Status updated to 'Payment Confirmed'"
echo "  âœ“ Timestamp recorded"
echo "  âœ“ User A notified (if notifications enabled)"
echo "  âœ“ Waiting for crypto release message displayed"
echo ""
read -p "Press Enter when Step 5 is complete..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 6: VERIFY PAYMENT (User A - Real World Action)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“± Real World Action (Simulated for Testing):"
echo ""
echo "In production, User A would:"
echo "  1. Check bank account for R12,000 deposit"
echo "  2. Verify payment reference matches"
echo "  3. Confirm amount is correct"
echo ""
echo "For testing, we'll assume payment verified."
echo ""
read -p "Press Enter to proceed to crypto release..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ”¸ STEP 7: RELEASE CRYPTO (User A - Seller)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Switch back to User A's browser window"
echo "2. Navigate to: http://localhost:9004/p2p-crypto/dashboard"
echo "3. Find the transaction (status: Payment Confirmed)"
echo "4. Click 'Release Crypto' button"
echo "5. Confirm the release"
echo ""
echo "Expected Results:"
echo "  âœ“ Success message: 'Crypto released successfully!'"
echo "  âœ“ Transaction status: 'Completed'"
echo "  âœ“ Fee deducted (0.5% = 0.00005 BTC)"
echo "  âœ“ User B receives: 0.00995 BTC (0.01 - 0.00005)"
echo "  âœ“ Platform collects: 0.00005 BTC fee"
echo "  âœ“ Stats updated for both users"
echo "  âœ“ Listing marked as completed"
echo ""
read -p "Press Enter when Step 7 is complete..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… STEP 8: VERIFY FINAL STATE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Verification Checklist:"
echo ""
echo "User A (Seller):"
echo "  [ ] Dashboard shows completed trade"
echo "  [ ] Stats: completedTrades +1"
echo "  [ ] Received R12,000 in bank account"
echo "  [ ] BTC balance decreased by 0.01"
echo ""
echo "User B (Buyer):"
echo "  [ ] Dashboard shows completed trade"
echo "  [ ] Stats: completedTrades +1"
echo "  [ ] BTC balance increased by 0.00995"
echo "  [ ] Paid R12,000 from bank account"
echo ""
echo "Platform:"
echo "  [ ] Fee collected: 0.00005 BTC"
echo "  [ ] Transaction record complete in Firestore"
echo "  [ ] Escrow released properly"
echo "  [ ] Listing status: completed"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ‰ TRADE WORKFLOW TEST COMPLETE!"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“Š ADDITIONAL TESTS TO PERFORM:"
echo ""
echo "Error Scenario Tests:"
echo "  [ ] Try creating listing without authentication"
echo "  [ ] Try exceeding tier limits"
echo "  [ ] Try accepting already matched listing"
echo "  [ ] Try confirming payment twice"
echo "  [ ] Try releasing crypto without payment confirmation"
echo ""
echo "UI/UX Tests:"
echo "  [ ] Test on mobile device"
echo "  [ ] Test on different browsers (Chrome, Safari, Firefox)"
echo "  [ ] Check responsive design"
echo "  [ ] Verify all buttons work"
echo "  [ ] Check loading states"
echo ""
echo "Performance Tests:"
echo "  [ ] Load marketplace with multiple listings"
echo "  [ ] Check page load times"
echo "  [ ] Monitor network requests"
echo "  [ ] Check console for errors"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“ TESTING NOTES:"
echo ""
echo "If you encounter any issues:"
echo "  1. Check browser console for errors"
echo "  2. Check terminal logs (npm run dev output)"
echo "  3. Check Firebase Console for Firestore data"
echo "  4. Review: docs/p2p-crypto-testing-guide.md"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸš€ READY FOR PRODUCTION DEPLOYMENT?"
echo ""
echo "Once all tests pass:"
echo "  1. Run: npm run build"
echo "  2. Deploy: vercel --prod"
echo "  3. Monitor first 24 hours"
echo ""
echo "See: docs/p2p-crypto-deployment-checklist.md"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
